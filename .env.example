# =============================================================================
# goflagship Configuration Example
# =============================================================================
# Copy this file to .env and customize for your environment.
# Environment variables take precedence over values in .env file.
#
# For production deployment, set these via your deployment system (K8s secrets,
# AWS Parameter Store, etc.) rather than using a .env file.
# =============================================================================

# -----------------------------------------------------------------------------
# Required Configuration
# -----------------------------------------------------------------------------

# ROLLOUT_SALT - Cryptographic salt for deterministic user bucketing (REQUIRED)
# 
# This value MUST be set explicitly in production and MUST remain stable across
# deployments. Changing this value will cause all users to be re-bucketed,
# potentially changing feature visibility for your entire user base.
#
# Generate a secure salt:
#   openssl rand -hex 16
#   Or: openssl rand -base64 24
#
# Security: This is not a password, but should be treated as a secret to prevent
# attackers from predicting user bucket assignments.
#
# If not set: A random salt is generated on startup (UNSAFE for production - 
# causes inconsistent bucketing across restarts).
ROLLOUT_SALT=your-stable-production-salt-change-me

# DB_DSN - PostgreSQL connection string (REQUIRED if STORE_TYPE=postgres)
#
# Format: postgres://username:password@host:port/database?options
# Example: postgres://flagship:flagship@localhost:5432/flagship?sslmode=disable
#
# Production notes:
#   - Use sslmode=require or sslmode=verify-full for production
#   - Ensure database exists and migrations are applied before starting
#   - Consider using connection pooling settings in DSN if needed
DB_DSN=postgres://flagship:flagship@localhost:5432/flagship?sslmode=disable

# ADMIN_API_KEY - Admin API key for write operations (REQUIRED for production)
#
# This key grants full access to create/update/delete flags and manage API keys.
# 
# Production requirement: MUST NOT use the default value "admin-123"
# Generate a secure key:
#   openssl rand -base64 32
#
# Note: With database-backed API keys, this serves as a fallback/bootstrap key.
ADMIN_API_KEY=admin-123

# -----------------------------------------------------------------------------
# Application Configuration
# -----------------------------------------------------------------------------

# APP_ENV - Application environment (dev, staging, prod)
# Used for environment-specific behavior and logging
# Production validation: If set to "prod", enforces stricter config checks
APP_ENV=dev

# APP_HTTP_ADDR - API server bind address
# Format: :port or host:port
# Examples: :8080 (all interfaces), localhost:8080 (local only), 0.0.0.0:8080
APP_HTTP_ADDR=:8080

# METRICS_ADDR - Metrics and profiling server bind address
# Exposes /metrics (Prometheus) and /debug/pprof (Go profiling)
# SECURITY: Should not be exposed publicly - bind to localhost or internal network
METRICS_ADDR=:9090

# STORE_TYPE - Storage backend type
# Options: "postgres" (persistent) or "memory" (ephemeral, for dev/testing only)
# Production: Use "postgres" for persistence across restarts
STORE_TYPE=postgres

# ENV - Flag environment name
# This determines which flags are loaded from the database
# Common values: prod, staging, dev, test
# Each environment has an isolated set of flags
ENV=prod

# -----------------------------------------------------------------------------
# Optional Configuration (Defaults shown)
# -----------------------------------------------------------------------------

# CLIENT_API_KEY - Legacy client API key (deprecated, use database keys instead)
CLIENT_API_KEY=client-xyz

# Rate limiting (requests per minute)
# RATE_LIMIT_PER_IP=100           # Unauthenticated requests per IP
# RATE_LIMIT_PER_KEY=1000         # Authenticated requests per key
# RATE_LIMIT_ADMIN_PER_KEY=60     # Admin operations per key

# AUTH_TOKEN_PREFIX=fsk_          # Prefix for API tokens

# =============================================================================
# Quick Start
# =============================================================================
# 1. Copy this file: cp .env.example .env
# 2. Generate rollout salt: ROLLOUT_SALT=$(openssl rand -hex 16)
# 3. Generate admin key: ADMIN_API_KEY=$(openssl rand -base64 32)
# 4. Update DB_DSN if using postgres
# 5. Run: make build && ./bin/server
# =============================================================================

